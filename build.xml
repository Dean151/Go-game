<?xml version="1.0" encoding="UTF-8"?>
<project name="testAnt" default="build" basedir=".">

    <property name="build.sysclasspath" value="ignore"/>
    <target name="clean">
        <mkdir dir="working"/>
        <mkdir dir="release"/>
        <delete includeEmptyDirs="true">
            <fileset dir="release">
                <include name="*/**"/>
            </fileset>
            <fileset dir="working">
                <include name="*/**"/>
            </fileset>
        </delete>
    </target>

    <target name="getJars" description="Get Jar dependencies">
        <property name="lib.location" location="lib"/>
        <mkdir dir="${lib.location}"/>
        <get src="http://central.maven.org/maven2/junit/junit/4.4/junit-4.4.jar" dest="${lib.location}" skipexisting="true"/>
    </target>

    <target name="compile" depends="clean, getJars">
        <mkdir dir="working/build"/>
        <javac srcdir="src" destdir="working/build"/>
        <mkdir dir="working/jar"/>
        <jar basedir="working/build" destfile="working/jar/goGame.jar"/>
        <mkdir dir="working/tests"/>

        <javac srcdir="test" destdir="working/tests">
            <classpath>
                <path location="working/jar/goGame.jar"/>
            </classpath>
            <classpath>
                <path location="lib/junit-4.4.jar"/>
            </classpath>
        </javac>
        <jar basedir="working/tests" destfile="working/jar/test.jar"/>
    </target>

    <target name="test" depends="compile">
        <junit haltonfailure="yes" haltonerror="yes">
            <classpath>
                <path location="working/jar/test.jar"/>
                <path location="working/jar/goGame.jar"/>
                <path location="lib/junit-4.4.jar"/>
            </classpath>

            <formatter type="plain"/>

            <test name="go.core.AllTests" outfile="working/testResult">
                <formatter type="xml"/>
            </test>
        </junit>
    </target>

    <target name="javadoc" depends="clean">
        <mkdir dir="release/javadoc"/>
        <javadoc packagenames="go.*"
                 sourcepath="src:test"
                 defaultexcludes="yes"
                 excludepackagenames="org.junit.*"
                 destdir="release/javadoc"
                 author="true"
                 version="true"
                 use="true"
                 classpath="lib/junit-4.4.jar"
                 windowtitle="Test API">

            <doctitle><![CDATA[<h1>Test</h1>]]></doctitle>
            <bottom><![CDATA[<i>Copyright &#169; 2000 Dummy Corp. All Rights Reserved.</i>]]></bottom>
            <tag name="todo" scope="all" description="To do:"/>
            <group title="Group 1 Packages" packages="com.dummy.test.a*"/>
            <group title="Group 2 Packages" packages="com.dummy.test.b*:com.dummy.test.c*"/>
            <link offline="true" href="http://docs.oracle.com/javase/7/docs/api/" packagelistLoc="C:\tmp"/>
            <link href="http://docs.oracle.com/javase/7/docs/api/"/>
        </javadoc>
    </target>

    <target name="build" description="Build the application" depends="test, javadoc">
        <copydir src="working/jar" dest="release/jar"/>
    </target>
</project>